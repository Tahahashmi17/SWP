// This is your Prisma schema file
// Learn more: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Room {
  id          String    @id @default(cuid())
  roomId      String    @unique
  hostId      String
  videoUrl    String?
  videoType   String?   // 'upload' | 'screen' | 'camera'
  isPlaying   Boolean   @default(false)
  currentTime Float     @default(0)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  
  messages    Message[]
  users       RoomUser[]
  
  @@index([roomId])
}

model RoomUser {
  id        String   @id @default(cuid())
  username  String
  roomId    String
  isHost    Boolean  @default(false)
  socketId  String?
  lastSeen  DateTime @default(now())
  
  room      Room     @relation(fields: [roomId], references: [roomId], onDelete: Cascade)
  messages  Message[]
  
  @@unique([roomId, username])
  @@index([roomId])
  @@index([socketId])
}

model Message {
  id        String   @id @default(cuid())
  roomId    String
  username  String
  content   String
  type      String   @default("text") // 'text' | 'system'
  createdAt DateTime @default(now())
  
  room      Room     @relation(fields: [roomId], references: [roomId], onDelete: Cascade)
  user      RoomUser @relation(fields: [roomId, username], references: [roomId, username], onDelete: Cascade)
  
  @@index([roomId])
  @@index([createdAt])
}